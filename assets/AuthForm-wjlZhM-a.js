import{j as _}from"./animations-C7mpbJ_1.js";import{a as pe,r as B}from"./vendor-Cf8TOEbQ.js";const k=new WeakMap,U=new WeakMap,N={current:[]};let H=!1,$=0;const P=new Set,R=new Map;function me(i){const r=Array.from(i).sort((t,e)=>t instanceof O&&t.options.deps.includes(e)?1:e instanceof O&&e.options.deps.includes(t)?-1:0);for(const t of r){if(N.current.includes(t))continue;N.current.push(t),t.recompute();const e=U.get(t);if(e)for(const s of e){const a=k.get(s);a&&me(a)}}}function Fe(i){i.listeners.forEach(r=>r({prevVal:i.prevState,currentVal:i.state}))}function Ee(i){i.listeners.forEach(r=>r({prevVal:i.prevState,currentVal:i.state}))}function Me(i){if($>0&&!R.has(i)&&R.set(i,i.prevState),P.add(i),!($>0)&&!H)try{for(H=!0;P.size>0;){const r=Array.from(P);P.clear();for(const t of r){const e=R.get(t)??t.prevState;t.prevState=e,Fe(t)}for(const t of r){const e=k.get(t);e&&(N.current.push(t),me(e))}for(const t of r){const e=k.get(t);if(e)for(const s of e)Ee(s)}}}finally{H=!1,N.current=[],R.clear()}}function D(i){$++;try{i()}finally{if($--,$===0){const r=Array.from(P)[0];r&&Me(r)}}}class se{constructor(r,t){this.listeners=new Set,this.subscribe=e=>{var s,a;this.listeners.add(e);const o=(a=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:a.call(s,e,this);return()=>{this.listeners.delete(e),o?.()}},this.setState=e=>{var s,a,o;this.prevState=this.state,this.state=(s=this.options)!=null&&s.updateFn?this.options.updateFn(this.prevState)(e):e(this.prevState),(o=(a=this.options)==null?void 0:a.onUpdate)==null||o.call(a),Me(this)},this.prevState=r,this.state=r,this.options=t}}class O{constructor(r){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=[],e=[];for(const s of this.options.deps)t.push(s.prevState),e.push(s.state);return this.lastSeenDepValues=e,{prevDepVals:t,currDepVals:e,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,e;this.prevState=this.state;const{prevDepVals:s,currDepVals:a,prevVal:o}=this.getDepVals();this.state=this.options.fn({prevDepVals:s,currDepVals:a,prevVal:o}),(e=(t=this.options).onUpdate)==null||e.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const a of this.options.deps)a instanceof O&&a.checkIfRecalculationNeededDeeply();let t=!1;const e=this.lastSeenDepValues,{currDepVals:s}=this.getDepVals();for(let a=0;a<s.length;a++)if(s[a]!==e[a]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var e,s;this.listeners.add(t);const a=(s=(e=this.options).onSubscribe)==null?void 0:s.call(e,t,this);return()=>{this.listeners.delete(t),a?.()}},this.options=r,this.state=r.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(r=this.options.deps){for(const t of r)if(t instanceof O)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof se){let e=k.get(t);e||(e=new Set,k.set(t,e)),e.add(this);let s=U.get(this);s||(s=new Set,U.set(this,s)),s.add(t)}}unregisterFromGraph(r=this.options.deps){for(const t of r)if(t instanceof O)this.unregisterFromGraph(t.options.deps);else if(t instanceof se){const e=k.get(t);e&&e.delete(this);const s=U.get(this);s&&s.delete(t)}}}function K(i,r){return typeof i=="function"?i(r):i}function ye(i,r){return oe(r).reduce((e,s)=>{if(e===null)return null;if(typeof e<"u")return e[s]},i)}function J(i,r,t){const e=oe(r);function s(a){if(!e.length)return K(t,a);const o=e.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(a))return typeof a=="object"?(a===null&&(a={}),{...a,[o]:s(a[o])}):{[o]:s()};if(Array.isArray(a)&&typeof o=="number"){const h=a.slice(0,o);return[...h.length?h:new Array(o),s(a[o]),...a.slice(o+1)]}return[...new Array(o),s()]}return s(i)}function we(i,r){const t=oe(r);function e(s){if(!s)return;if(t.length===1){const o=t[0];if(Array.isArray(s)&&typeof o=="number")return s.filter((u,c)=>c!==o);const{[o]:h,...p}=s;return p}const a=t.shift();if(typeof a=="string"&&typeof s=="object")return{...s,[a]:e(s[a])};if(typeof a=="number"&&Array.isArray(s)){if(a>=s.length)return s;const o=s.slice(0,a);return[...o.length?o:new Array(a),e(s[a]),...s.slice(a+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(i)}const _e=/^(\d*)$/gm,Ae=/\.(\d*)\./gm,Oe=/^(\d*)\./gm,De=/\.(\d*$)/gm,ke=/\.{2,}/gm,ie="__int__",z=`${ie}$1`;function oe(i){if(Array.isArray(i))return[...i];if(typeof i!="string")throw new Error("Path must be a string.");return i.replace(/\[/g,".").replace(/\]/g,"").replace(_e,z).replace(Ae,`.${z}.`).replace(Oe,`${z}.`).replace(De,`.${z}`).replace(ke,".").split(".").map(r=>r.indexOf(ie)===0?parseInt(r.substring(ie.length),10):r)}function Ie(i){return!(Array.isArray(i)&&i.length===0)}function re(i,r){const{asyncDebounceMs:t}=r,{onChangeAsync:e,onBlurAsync:s,onSubmitAsync:a,onBlurAsyncDebounceMs:o,onChangeAsyncDebounceMs:h}=r.validators||{},p=t??0,u={cause:"change",validate:e,debounceMs:h??p},c={cause:"blur",validate:s,debounceMs:o??p},l={cause:"submit",validate:a,debounceMs:0},n=d=>({...d,debounceMs:0});switch(i){case"submit":return[n(u),n(c),l];case"blur":return[c];case"change":return[u];case"server":default:return[]}}function ae(i,r){const{onChange:t,onBlur:e,onSubmit:s,onMount:a}=r.validators||{},o={cause:"change",validate:t},h={cause:"blur",validate:e},p={cause:"submit",validate:s},u={cause:"mount",validate:a},c={cause:"server",validate:()=>{}};switch(i){case"mount":return[u];case"submit":return[o,h,p,c];case"server":return[c];case"blur":return[h,c];case"change":default:return[o,c]}}const ge=i=>!!i&&typeof i=="object"&&"fields"in i;function Q(i,r){if(Object.is(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;if(i instanceof Map&&r instanceof Map){if(i.size!==r.size)return!1;for(const[e,s]of i)if(!r.has(e)||!Object.is(s,r.get(e)))return!1;return!0}if(i instanceof Set&&r instanceof Set){if(i.size!==r.size)return!1;for(const e of i)if(!r.has(e))return!1;return!0}const t=Object.keys(i);if(t.length!==Object.keys(r).length)return!1;for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(r,t[e])||!Object.is(i[t[e]],r[t[e]]))return!1;return!0}function Te(i){const r=new Map;for(const t of i){const e=[...t.path??[]].map(s=>{const a=typeof s=="object"?s.key:s;return typeof a=="number"?`[${a}]`:a}).join(".").replace(/\.\[/g,"[");r.set(e,(r.get(e)??[]).concat(t))}return Object.fromEntries(r)}const Pe=i=>i,$e=i=>{const r=Te(i);return{form:r,fields:r}},ue=(i,r)=>i==="form"?$e(r):Pe(r),Se={validate({value:i,validationSource:r},t){const e=t["~standard"].validate(i);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return ue(r,e.issues)},async validateAsync({value:i,validationSource:r},t){const e=await t["~standard"].validate(i);if(e.issues)return ue(r,e.issues)}},Ve=i=>!!i&&"~standard"in i;function W(i){function r(l,n,d,f){const v=e(l,n,d,f);({insert:()=>h(v,l,n),remove:()=>p(v),swap:()=>f!==void 0&&c(v,l,n,f),move:()=>f!==void 0&&u(v,l,n,f)})[d]()}function t(l,n){return`${l}[${n}]`}function e(l,n,d,f){const v=[t(l,n)];if(d==="swap")v.push(t(l,f));else if(d==="move"){const[m,y]=[Math.min(n,f),Math.max(n,f)];for(let M=m;M<=y;M++)v.push(t(l,M))}else{const m=i.getFieldValue(l),y=Array.isArray(m)?m.length:0;for(let M=n+1;M<y;M++)v.push(t(l,M))}return Object.keys(i.fieldInfo).filter(m=>v.some(y=>m.startsWith(y)))}function s(l,n){return l.replace(/\[(\d+)\]/,(d,f)=>{const v=parseInt(f,10);return`[${n==="up"?v+1:Math.max(0,v-1)}]`})}function a(l,n){(n==="up"?l:[...l].reverse()).forEach(f=>{const v=s(f.toString(),n),m=i.getFieldMeta(v);m&&i.setFieldMeta(f,m)})}const o=()=>({isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{}}),h=(l,n,d)=>{a(l,"down"),l.forEach(f=>{f.toString().startsWith(t(n,d))&&i.setFieldMeta(f,o())})},p=l=>{a(l,"up")},u=(l,n,d,f)=>{const v=new Map(Object.keys(i.fieldInfo).filter(m=>m.startsWith(t(n,d))).map(m=>[m,i.getFieldMeta(m)]));a(l,d<f?"up":"down"),Object.keys(i.fieldInfo).filter(m=>m.startsWith(t(n,f))).forEach(m=>{const y=m.replace(t(n,f),t(n,d)),M=v.get(y);M&&i.setFieldMeta(m,M)})},c=(l,n,d,f)=>{l.forEach(v=>{if(!v.toString().startsWith(t(n,d)))return;const m=v.toString().replace(t(n,d),t(n,f)),[y,M]=[i.getFieldMeta(v),i.getFieldMeta(m)];y&&i.setFieldMeta(m,y),M&&i.setFieldMeta(v,M)})};return{handleArrayFieldMetaShift:r}}function X(i){return{values:i.values??{},errorMap:i.errorMap??{},fieldMetaBase:i.fieldMetaBase??{},isSubmitted:i.isSubmitted??!1,isSubmitting:i.isSubmitting??!1,isValidating:i.isValidating??!1,submissionAttempts:i.submissionAttempts??0,validationMetaMap:i.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class Be{constructor(r){var t;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.prevFieldsErrorMap={},this.mount=()=>{const e=this.fieldMetaDerived.mount(),s=this.store.mount(),a=()=>{e(),s()},{onMount:o}=this.options.validators||{};return o&&this.validateSync("mount"),a},this.update=e=>{if(!e)return;const s=this.options;this.options=e;const a=e.defaultValues&&!Q(e.defaultValues,s.defaultValues)&&!this.state.isTouched,o=!Q(e.defaultState,s.defaultState)&&!this.state.isTouched;!a&&!o||D(()=>{this.baseStore.setState(()=>X(Object.assign({},this.state,o?e.defaultState:{},a?{values:e.defaultValues}:{})))})},this.reset=(e,s)=>{const{fieldMeta:a}=this.state,o=this.resetFieldMeta(a);e&&!s?.keepDefaultValues&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var h;return X({...this.options.defaultState,values:e??this.options.defaultValues??((h=this.options.defaultState)==null?void 0:h.values),fieldMetaBase:o})})},this.validateAllFields=async e=>{const s=[];return D(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const h=o.instance;s.push(Promise.resolve().then(()=>h.validate(e,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(p=>({...p,isTouched:!0}))})}),(await Promise.all(s)).flat()},this.validateArrayFieldsStartingFrom=async(e,s,a)=>{const o=this.getFieldValue(e),h=Array.isArray(o)?Math.max(o.length-1,0):null,p=[`${e}[${s}]`];for(let n=s+1;n<=(h??0);n++)p.push(`${e}[${n}]`);const u=Object.keys(this.fieldInfo).filter(n=>p.some(d=>n.startsWith(d))),c=[];return D(()=>{u.forEach(n=>{c.push(Promise.resolve().then(()=>this.validateField(n,a)))})}),(await Promise.all(c)).flat()},this.validateField=(e,s)=>{var a;const o=(a=this.fieldInfo[e])==null?void 0:a.instance;return o?(o.state.meta.isTouched||o.setMeta(h=>({...h,isTouched:!0})),o.validate(s)):[]},this.validateSync=e=>{const s=ae(e,this.options);let a=!1;const o={};return D(()=>{var h;for(const u of s){if(!u.validate)continue;const c=this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:l,fieldErrors:n}=ne(c),d=L(u.cause);if(n)for(const[f,v]of Object.entries(n)){const y={...o[f]||{},[d]:v};o[f]=y;const M=this.getFieldMeta(f);M&&M.errorMap[d]!==v&&this.setFieldMeta(f,S=>({...S,errorMap:{...S.errorMap,[d]:v}}))}for(const f of Object.keys(this.prevFieldsErrorMap)){const v=this.getFieldMeta(f);v?.errorMap[d]&&!((h=o[f])!=null&&h[d])&&this.setFieldMeta(f,m=>({...m,errorMap:{...m.errorMap,[d]:void 0}}))}this.state.errorMap[d]!==l&&this.baseStore.setState(f=>({...f,errorMap:{...f.errorMap,[d]:l}})),(l||n)&&(a=!0)}const p=L("submit");this.state.errorMap[p]&&e!=="submit"&&!a&&this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[p]:void 0}}))}),this.prevFieldsErrorMap=o,{hasErrored:a,fieldsErrorMap:o}},this.validateAsync=async e=>{const s=re(e,this.options);this.state.isFormValidating||this.baseStore.setState(u=>({...u,isFormValidating:!0}));const a=[];let o;for(const u of s){if(!u.validate)continue;const c=L(u.cause),l=this.state.validationMetaMap[c];l?.lastAbortController.abort();const n=new AbortController;this.state.validationMetaMap[c]={lastAbortController:n},a.push(new Promise(async d=>{let f;try{f=await new Promise((M,S)=>{setTimeout(async()=>{if(n.signal.aborted)return M(void 0);try{M(await this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:n.signal},type:"validateAsync"}))}catch(V){S(V)}},u.debounceMs)})}catch(M){f=M}const{formError:v,fieldErrors:m}=ne(f);m&&(o=o?{...o,...m}:m);const y=L(u.cause);if(o)for(const[M,S]of Object.entries(o)){const V=this.getFieldMeta(M);V&&V.errorMap[y]!==S&&this.setFieldMeta(M,A=>({...A,errorMap:{...A.errorMap,[y]:S}}))}this.baseStore.setState(M=>({...M,errorMap:{...M.errorMap,[y]:v}})),d(o?{fieldErrors:o,errorMapKey:y}:void 0)}))}let h=[];const p={};if(a.length){h=await Promise.all(a);for(const u of h)if(u?.fieldErrors){const{errorMapKey:c}=u;for(const[l,n]of Object.entries(u.fieldErrors)){const f={...p[l]||{},[c]:n};p[l]=f}}}return this.baseStore.setState(u=>({...u,isFormValidating:!1})),p},this.validate=e=>{const{hasErrored:s,fieldsErrorMap:a}=this.validateSync(e);return s&&!this.options.asyncAlways?a:this.validateAsync(e)},this.getFieldValue=e=>ye(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var s;return(s=this.fieldInfo)[e]||(s[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,s)=>{this.baseStore.setState(a=>({...a,fieldMetaBase:{...a.fieldMetaBase,[e]:K(s,a.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((s,a)=>{const o=a;return s[o]={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{}},s},{}),this.setFieldValue=(e,s,a)=>{const o=a?.dontUpdateMeta??!1;D(()=>{o||this.setFieldMeta(e,h=>({...h,isTouched:!0,isDirty:!0,errorMap:{...h?.errorMap,onMount:void 0}})),this.baseStore.setState(h=>({...h,values:J(h.values,e,s)}))})},this.deleteField=e=>{this.baseStore.setState(s=>{const a={...s};return a.values=we(a.values,e),delete a.fieldMetaBase[e],a}),delete this.fieldInfo[e]},this.pushFieldValue=(e,s,a)=>{this.setFieldValue(e,o=>[...Array.isArray(o)?o:[],s],a),this.validateField(e,"change")},this.insertFieldValue=async(e,s,a,o)=>{this.setFieldValue(e,h=>[...h.slice(0,s),a,...h.slice(s)],o),await this.validateField(e,"change"),W(this).handleArrayFieldMetaShift(e,s,"insert"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.replaceFieldValue=async(e,s,a,o)=>{this.setFieldValue(e,h=>h.map((p,u)=>u===s?a:p),o),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.removeFieldValue=async(e,s,a)=>{const o=this.getFieldValue(e),h=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(e,p=>p.filter((u,c)=>c!==s),a),W(this).handleArrayFieldMetaShift(e,s,"remove"),h!==null){const p=`${e}[${h}]`;Object.keys(this.fieldInfo).filter(c=>c.startsWith(p)).forEach(c=>this.deleteField(c))}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,s,"change")},this.swapFieldValues=(e,s,a,o)=>{this.setFieldValue(e,h=>{const p=h[s],u=h[a];return J(J(h,`${s}`,u),`${a}`,p)},o),W(this).handleArrayFieldMetaShift(e,s,"swap",a),this.validateField(e,"change"),this.validateField(`${e}[${s}]`,"change"),this.validateField(`${e}[${a}]`,"change")},this.moveFieldValues=(e,s,a,o)=>{this.setFieldValue(e,h=>(h.splice(a,0,h.splice(s,1)[0]),h),o),W(this).handleArrayFieldMetaShift(e,s,"move",a),this.validateField(e,"change"),this.validateField(`${e}[${s}]`,"change"),this.validateField(`${e}[${a}]`,"change")},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[s,a])=>(Object.keys(a).length&&a.errors.length&&(e[s]={errors:a.errors,errorMap:a.errorMap}),e),{})}),this.baseStore=new se(X({...r?.defaultState,values:r?.defaultValues??((t=r?.defaultState)==null?void 0:t.values)})),this.fieldMetaDerived=new O({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:s,prevVal:a})=>{var o;const h=a,p=e?.[0],u=s[0];let c=0;const l={};for(const n of Object.keys(u.fieldMetaBase)){const d=u.fieldMetaBase[n],f=p?.fieldMetaBase[n],v=h?.[n];let m=v?.errors;if(!f||d.errorMap!==f.errorMap){m=Object.values(d.errorMap??{}).filter(S=>S!==void 0);const M=(o=this.getFieldInfo(n))==null?void 0:o.instance;M&&!M.options.disableErrorFlat&&(m=m?.flat(1))}const y=!d.isDirty;if(v&&v.isPristine===y&&v.errors===m&&d===f){l[n]=v,c++;continue}l[n]={...d,errors:m,isPristine:y}}return h&&c===Object.keys(u.fieldMetaBase).length?h:l}}),this.store=new O({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:s,prevVal:a})=>{var o,h,p,u;const c=a,l=e?.[0],n=s[0],d=Object.values(n.fieldMetaBase),f=d.some(g=>g?.isValidating),v=!d.some(g=>g?.errorMap&&Ie(Object.values(g.errorMap).filter(Boolean))),m=d.some(g=>g?.isTouched),y=d.some(g=>g?.isBlurred),M=m&&((o=n?.errorMap)==null?void 0:o.onMount),S=d.some(g=>g?.isDirty),V=!S,A=!!((h=n.errorMap)!=null&&h.onMount||d.some(g=>{var w;return(w=g?.errorMap)==null?void 0:w.onMount})),E=!!f;let b=c?.errors??[];(!l||n.errorMap!==l.errorMap)&&(b=Object.values(n.errorMap).reduce((g,w)=>w===void 0?g:w&&ge(w)?(g.push(w.form),g):(g.push(w),g),[]));const F=b.length===0,I=v&&F,j=n.submissionAttempts===0&&!m&&!A||!E&&!n.isSubmitting&&I;let C=n.errorMap;if(M&&(b=b.filter(g=>g!==n.errorMap.onMount),C=Object.assign(C,{onMount:void 0})),c&&l&&c.errorMap===C&&c.fieldMeta===this.fieldMetaDerived.state&&c.errors===b&&c.isFieldsValidating===f&&c.isFieldsValid===v&&c.isFormValid===F&&c.isValid===I&&c.canSubmit===j&&c.isTouched===m&&c.isBlurred===y&&c.isPristine===V&&c.isDirty===S&&Q(l,n))return c;let x={...n,errorMap:C,fieldMeta:this.fieldMetaDerived.state,errors:b,isFieldsValidating:f,isFieldsValid:v,isFormValid:F,isValid:I,canSubmit:j,isTouched:m,isBlurred:y,isPristine:V,isDirty:S};const q=((p=this.options.transform)==null?void 0:p.deps)??[];if(q.length!==this.prevTransformArray.length||q.some((g,w)=>g!==this.prevTransformArray[w])){const g=Object.assign({},this,{state:x});(u=this.options.transform)==null||u.fn(g),x=g.state,this.prevTransformArray=q}return x}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(r||{})}get state(){return this.store.state}runValidator(r){return Ve(r.validate)?Se[r.type](r.value,r.validate):r.validate(r.value)}async handleSubmit(r){var t,e,s,a,o,h;if(this.baseStore.setState(u=>({...u,isSubmitted:!1,submissionAttempts:u.submissionAttempts+1})),!this.state.canSubmit)return;this.baseStore.setState(u=>({...u,isSubmitting:!0}));const p=()=>{this.baseStore.setState(u=>({...u,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){p(),(e=(t=this.options).onSubmitInvalid)==null||e.call(t,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){p(),(a=(s=this.options).onSubmitInvalid)==null||a.call(s,{value:this.state.values,formApi:this});return}D(()=>{Object.values(this.fieldInfo).forEach(u=>{var c,l,n;(n=(l=(c=u.instance)==null?void 0:c.options.listeners)==null?void 0:l.onSubmit)==null||n.call(l,{value:u.instance.state.value,fieldApi:u.instance})})});try{await((h=(o=this.options).onSubmit)==null?void 0:h.call(o,{value:this.state.values,formApi:this,meta:r??this.options.onSubmitMeta})),D(()=>{this.baseStore.setState(u=>({...u,isSubmitted:!0})),p()})}catch(u){throw p(),u}}setErrorMap(r){this.baseStore.setState(t=>({...t,errorMap:{...t.errorMap,...r}}))}}function ne(i){if(i){if(ge(i)){const r=ne(i.form).formError,t=i.fields;return{formError:r,fieldErrors:t}}return{formError:i}}return{formError:void 0}}function L(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class je{constructor(r){this.options={},this.mount=()=>{var t,e;const s=this.store.mount(),a=this.getInfo();a.instance=this,this.update(this.options);const{onMount:o}=this.options.validators||{};if(o){const h=this.runValidator({validate:o,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});h&&this.setMeta(p=>({...p,errorMap:{...p?.errorMap,onMount:h}}))}return(e=(t=this.options.listeners)==null?void 0:t.onMount)==null||e.call(t,{value:this.state.value,fieldApi:this}),s},this.update=t=>{if(this.state.value===void 0){const e=ye(t.form.options.defaultValues,t.name);t.defaultValue!==void 0?this.setValue(t.defaultValue,{dontUpdateMeta:!0}):e!==void 0&&this.setValue(e,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta),this.options=t,this.name=t.name},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,e)=>{var s,a;this.form.setFieldValue(this.name,t,e),(a=(s=this.options.listeners)==null?void 0:s.onChange)==null||a.call(s,{value:this.state.value,fieldApi:this}),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,e)=>this.form.pushFieldValue(this.name,t,e),this.insertValue=(t,e,s)=>this.form.insertFieldValue(this.name,t,e,s),this.replaceValue=(t,e,s)=>this.form.replaceFieldValue(this.name,t,e,s),this.removeValue=(t,e)=>this.form.removeFieldValue(this.name,t,e),this.swapValues=(t,e,s)=>this.form.swapFieldValues(this.name,t,e,s),this.moveValue=(t,e,s)=>this.form.moveFieldValues(this.name,t,e,s),this.getLinkedFields=t=>{const e=Object.values(this.form.fieldInfo),s=[];for(const a of e){if(!a.instance)continue;const{onChangeListenTo:o,onBlurListenTo:h}=a.instance.options.validators||{};t==="change"&&o?.includes(this.name)&&s.push(a.instance),t==="blur"&&h?.includes(this.name)&&s.push(a.instance)}return s},this.validateSync=(t,e)=>{const s=ae(t,this.options),o=this.getLinkedFields(t).reduce((u,c)=>{const l=ae(t,c.options);return l.forEach(n=>{n.field=c}),u.concat(l)},[]);let h=!1;D(()=>{const u=(c,l)=>{const n=T(l.cause),d=l.validate?ce(c.runValidator({validate:l.validate,value:{value:c.store.state.value,validationSource:"field",fieldApi:c},type:"validate"})):e[n];c.state.meta.errorMap[n]!==d&&c.setMeta(f=>({...f,errorMap:{...f.errorMap,[T(l.cause)]:d||e[n]}})),(d||e[n])&&(h=!0)};for(const c of s)u(this,c);for(const c of o)c.validate&&u(c.field,c)});const p=T("submit");return this.state.meta.errorMap[p]&&t!=="submit"&&!h&&this.setMeta(u=>({...u,errorMap:{...u.errorMap,[p]:void 0}})),{hasErrored:h}},this.validateAsync=async(t,e)=>{const s=re(t,this.options),a=await e,o=this.getLinkedFields(t),h=o.reduce((n,d)=>{const f=re(t,d.options);return f.forEach(v=>{v.field=d}),n.concat(f)},[]);this.state.meta.isValidating||this.setMeta(n=>({...n,isValidating:!0}));for(const n of o)n.setMeta(d=>({...d,isValidating:!0}));const p=[],u=[],c=(n,d,f)=>{const v=T(d.cause),m=n.getInfo().validationMetaMap[v];m?.lastAbortController.abort();const y=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:y},f.push(new Promise(async M=>{var S;let V;try{V=await new Promise((F,I)=>{this.timeoutIds[d.cause]&&clearTimeout(this.timeoutIds[d.cause]),this.timeoutIds[d.cause]=setTimeout(async()=>{if(y.signal.aborted)return F(void 0);try{F(await this.runValidator({validate:d.validate,value:{value:n.store.state.value,fieldApi:n,signal:y.signal,validationSource:"field"},type:"validateAsync"}))}catch(j){I(j)}},d.debounceMs)})}catch(F){V=F}if(y.signal.aborted)return M(void 0);const A=ce(V),E=(S=a[this.name])==null?void 0:S[v],b=A||E;n.setMeta(F=>({...F,errorMap:{...F?.errorMap,[v]:b}})),M(b)}))};for(const n of s)n.validate&&c(this,n,p);for(const n of h)n.validate&&c(n.field,n,u);let l=[];(p.length||u.length)&&(l=await Promise.all(p),await Promise.all(u)),this.setMeta(n=>({...n,isValidating:!1}));for(const n of o)n.setMeta(d=>({...d,isValidating:!1}));return l.filter(Boolean)},this.validate=(t,e)=>{var s;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:a}=e?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:o}=this.validateSync(t,a[this.name]??{});if(o&&!this.options.asyncAlways)return(s=this.getInfo().validationMetaMap[T(t)])==null||s.lastAbortController.abort(),this.state.meta.errors;const h=e?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,h)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{var t,e;this.state.meta.isTouched||(this.setMeta(a=>({...a,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(a=>({...a,isBlurred:!0})),this.validate("blur"),(e=(t=this.options.listeners)==null?void 0:t.onBlur)==null||e.call(t,{value:this.state.value,fieldApi:this})},this.form=r.form,this.name=r.name,this.timeoutIds={},r.defaultValue!==void 0&&this.form.setFieldValue(this.name,r.defaultValue,{dontUpdateMeta:!0}),this.store=new O({deps:[this.form.store],fn:()=>{const t=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{},...r.defaultMeta};return{value:t,meta:e}}}),this.options=r}get state(){return this.store.state}runValidator(r){return Ve(r.validate)?Se[r.type](r.value,r.validate):r.validate(r.value)}setErrorMap(r){this.setMeta(t=>({...t,errorMap:{...t.errorMap,...r}}))}}function ce(i){if(i)return i}function T(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}var Y={exports:{}},Z={},ee={exports:{}},te={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var de;function Ce(){if(de)return te;de=1;var i=pe();function r(l,n){return l===n&&(l!==0||1/l===1/n)||l!==l&&n!==n}var t=typeof Object.is=="function"?Object.is:r,e=i.useState,s=i.useEffect,a=i.useLayoutEffect,o=i.useDebugValue;function h(l,n){var d=n(),f=e({inst:{value:d,getSnapshot:n}}),v=f[0].inst,m=f[1];return a(function(){v.value=d,v.getSnapshot=n,p(v)&&m({inst:v})},[l,d,n]),s(function(){return p(v)&&m({inst:v}),l(function(){p(v)&&m({inst:v})})},[l]),o(d),d}function p(l){var n=l.getSnapshot;l=l.value;try{var d=n();return!t(l,d)}catch{return!0}}function u(l,n){return n()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:h;return te.useSyncExternalStore=i.useSyncExternalStore!==void 0?i.useSyncExternalStore:c,te}var he;function Re(){return he||(he=1,ee.exports=Ce()),ee.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fe;function ze(){if(fe)return Z;fe=1;var i=pe(),r=Re();function t(u,c){return u===c&&(u!==0||1/u===1/c)||u!==u&&c!==c}var e=typeof Object.is=="function"?Object.is:t,s=r.useSyncExternalStore,a=i.useRef,o=i.useEffect,h=i.useMemo,p=i.useDebugValue;return Z.useSyncExternalStoreWithSelector=function(u,c,l,n,d){var f=a(null);if(f.current===null){var v={hasValue:!1,value:null};f.current=v}else v=f.current;f=h(function(){function y(E){if(!M){if(M=!0,S=E,E=n(E),d!==void 0&&v.hasValue){var b=v.value;if(d(b,E))return V=b}return V=E}if(b=V,e(S,E))return b;var F=n(E);return d!==void 0&&d(b,F)?(S=E,b):(S=E,V=F)}var M=!1,S,V,A=l===void 0?null:l;return[function(){return y(c())},A===null?void 0:function(){return y(A())}]},[c,l,n,d]);var m=s(u,f[0],f[1]);return o(function(){v.hasValue=!0,v.value=m},[m]),p(m),m},Z}var ve;function We(){return ve||(ve=1,Y.exports=ze()),Y.exports}var Le=We();function le(i,r=t=>t){return Le.useSyncExternalStoreWithSelector(i.subscribe,()=>i.state,()=>i.state,r,Ue)}function Ue(i,r){if(Object.is(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;if(i instanceof Map&&r instanceof Map){if(i.size!==r.size)return!1;for(const[e,s]of i)if(!r.has(e)||!Object.is(s,r.get(e)))return!1;return!0}if(i instanceof Set&&r instanceof Set){if(i.size!==r.size)return!1;for(const e of i)if(!r.has(e))return!1;return!0}const t=Object.keys(i);if(t.length!==Object.keys(r).length)return!1;for(let e=0;e<t.length;e++)if(!Object.prototype.hasOwnProperty.call(r,t[e])||!Object.is(i[t[e]],r[t[e]]))return!1;return!0}const G=typeof window<"u"?B.useLayoutEffect:B.useEffect;function Ne(i){const[r]=B.useState(()=>{const e=new je({...i,form:i.form,name:i.name});return e.Field=be,e});return G(r.mount,[r]),G(()=>{r.update(i)}),le(r.store,i.mode==="array"?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),r}const be=({children:i,...r})=>{const t=Ne(r),e=B.useMemo(()=>K(i,t),[i,t,t.state.value,t.state.meta]);return _.jsx(_.Fragment,{children:e})};function Ge({form:i,selector:r,children:t}){const e=le(i.store,r);return K(t,e)}function Ke(i){const[r]=B.useState(()=>{const t=new Be(i),e=t;return e.Field=function(a){return _.jsx(be,{...a,form:t})},e.Subscribe=s=>_.jsx(Ge,{form:t,selector:s.selector,children:s.children}),e});return G(r.mount,[]),le(r.store,t=>t.isSubmitting),G(()=>{r.update(i)}),r}function Je(){const i=Ke({defaultValues:{fullName:""},onSubmit:async({value:r})=>{console.log(r)}});return _.jsx("div",{children:_.jsxs("form",{onSubmit:r=>{r.preventDefault(),r.stopPropagation(),i.handleSubmit()},children:[_.jsx("div",{children:_.jsx(i.Field,{name:"fullName",children:r=>_.jsx("input",{name:r.name,value:r.state.value,onBlur:r.handleBlur,onChange:t=>r.handleChange(t.target.value)})})}),_.jsx("button",{type:"submit",children:"Submit"})]})})}export{Je as default};
